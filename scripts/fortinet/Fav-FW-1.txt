# admin/admin

config system global
    set hostname Fav-FW-1
    set admintimeout 30
    set timezone 26
end

config system interface
    edit port1
        set desc "HA-SW-1"
        set mode static
        set ip 103.152.126.1 255.255.255.0
        set role wan
        set allowaccess ping
    next
    edit port2
        set role lan
        set allowaccess ping
    next
    edit VLAN_10
        set desc "Linux Clients"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 10
        set mode static
        set ip 192.168.10.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_20
        set desc "Windows Clients"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 20
        set mode static
        set ip 192.168.20.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_21
        set desc "Windows Clients ISOLATED"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 21
        set mode static
        set ip 192.168.21.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_30
        set desc "Switch Management"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 30
        set mode static
        set ip 192.168.30.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_31
        set desc "Switch R-SPAN Mirroring"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 31
        set mode static
        set ip 192.168.31.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_42
        set desc "VoIP-Ger√§te"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 42
        set mode static
        set ip 192.168.42.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_100
        set desc "Ubuntu Server"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 100
        set mode static
        set ip 192.168.100.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_150
        set desc "Bastion"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 150
        set mode static
        set ip 192.168.150.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_200
        set desc "Windows Server"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 200
        set mode static
        set ip 192.168.200.254 255.255.255.0
        set allowaccess ping
    next
    edit VLAN_201
        set desc "Offline Root CA"
        set vdom root
        set interface port2
        set type vlan
        set vlanid 201
        set mode static
        set ip 192.168.201.254 255.255.255.0
        set allowaccess ping
    next
end

config router static
    edit 1
        set dst 0.0.0.0 0.0.0.0
        set gateway 103.152.126.254
        set device port1
        set distance 10
    next
    edit 2
        set dst 0.0.0.0 0.0.0.0
        set gateway 103.152.125.254
        set device port1
        set distance 20
    next
end

config firewall ssl-ssh-profile
    edit custom-deep-inspection
        config ssl
            set inspect-all deep-inspection
            set client-certificate inspect
            set unsupported-ssl-version block
            set unsupported-ssl-cipher block
            set unsupported-ssl-negotiation block
            set expired-server-cert block
            set untrusted-server-cert block
            set cert-validation-timeout ignore
            set cert-validation-failure block
            set sni-server-cert-check strict
            set min-allowed-ssl-version tls-1.3
        end
        config https
            set client-certificate inspect
            set unsupported-ssl-version block
            set unsupported-ssl-cipher block
            set unsupported-ssl-negotiation block
        end
        set server-cert-mode re-sign
    next
end

# traffic shaping
# voip high prio (medium band)
# youtube medium prio (viel band)
# rest low prio (der rest? band)
config firewall shaper traffic-shaper
    edit high-priority
        set per-policy enable
        set priority high
        set bandwidth-unit kbps
        set guaranteed-bandwidth 300
        set maximum-bandwidth 1000000
    next
    edit medium-priority
        set per-policy enable
        set priority medium
        set bandwidth-unit kbps
        set guaranteed-bandwidth 1500
        set maximum-bandwidth 1000000
    next
    edit low-priority
        set per-policy enable
        set priority low
        set bandwidth-unit kbps
        set maximum-bandwidth 1000000
    next
end

config firewall address
    edit "Fav-W-Workstations"
        set type iprange
        set start-ip 192.168.20.1
        set end-ip 192.168.20.253
    next
    edit "IP-Phone-Langenzersdorf"
        set type ipmask
        set subnet 10.10.42.1/32
    next
    edit "IP-Phone-Favoriten"
        set type ipmask
        set subnet 192.168.42.1/32
    next
end

config firewall shaping-policy
    edit 1
        set name VOIP
        set status enable
        set ip-version 4
        set service FINGER H323
        set srcaddr "IP-Phone-Langenzersdorf"
        set dstaddr "IP-Phone-Favoriten"
        # set dstintf AAAAAAA
        set traffic-shaper high-priority
    next
    edit 2
        set name YT
        set status enable
        set ip-version 4
        set srcaddr "Fav-W-Workstations"
        set srcintf VLAN_20
        set dstintf port1
        set internet-service enable
        set internet-service-name Google-Web
        # YTs app ID
        set application 16040
        set traffic-shaper medium-priority
    next
end

# custom ip for nat traffic outside
config firewall ippool
    edit "NAT_Public_IP_Pool"
        set startip 103.152.126.69
        set endip 103.152.126.69
        set type one-to-one
    next
end

config firewall policy
    edit 1
        set name "non-VPN-PAT-to-Outside"
        set srcintf "port2" "VLAN_10" "VLAN_20" "VLAN_21" "VLAN_100" "VLAN_150" "VLAN_200" "VLAN_201"
        set dstintf "port1"
        set srcaddr "all"
          # WARNING: CHANGE THIS FOR VPN?
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set nat enable
        set ippool enable
        set poolname "NAT_Public_IP_Pool"
        set logtraffic all
    next
end

# bogon definition weil es die nicht schon gibt anscheinend
config firewall address
    edit "Bogon_0.0.0.0_8"
        set subnet 0.0.0.0 255.0.0.0
    next
    edit "Bogon_10.0.0.0_8"
        set subnet 10.0.0.0 255.0.0.0
    next
    edit "Bogon_100.64.0.0_10"
        set subnet 100.64.0.0 255.192.0.0
    next
    edit "Bogon_127.0.0.0_8"
        set subnet 127.0.0.0 255.0.0.0
    next
    edit "Bogon_169.254.0.0_16"
        set subnet 169.254.0.0 255.255.0.0
    next
    edit "Bogon_172.16.0.0_12"
        set subnet 172.16.0.0 255.240.0.0
    next
    edit "Bogon_192.0.0.0_24"
        set subnet 192.0.0.0 255.255.255.0
    next
    edit "Bogon_192.0.2.0_24"
        set subnet 192.0.2.0 255.255.255.0
    next
    edit "Bogon_192.88.99.0_24"
        set subnet 192.88.99.0 255.255.255.0
    next
    edit "Bogon_192.168.0.0_16"
        set subnet 192.168.0.0 255.255.0.0
    next
    edit "Bogon_198.18.0.0_15"
        set subnet 198.18.0.0 255.254.0.0
    next
    edit "Bogon_198.51.100.0_24"
        set subnet 198.51.100.0 255.255.255.0
    next
    edit "Bogon_203.0.113.0_24"
        set subnet 203.0.113.0 255.255.255.0
    next
    edit "Bogon_224.0.0.0_4"
        set subnet 224.0.0.0 240.0.0.0
    next
    edit "Bogon_240.0.0.0_4"
        set subnet 240.0.0.0 240.0.0.0
    next
    edit "Bogon_255.255.255.255_32"
        set subnet 255.255.255.255 255.255.255.255
    next
end

config firewall addrgrp
    edit "Bogon_Group"
        set member "Bogon_0.0.0.0_8" "Bogon_10.0.0.0_8" "Bogon_100.64.0.0_10" "Bogon_127.0.0.0_8" "Bogon_169.254.0.0_16" "Bogon_172.16.0.0_12" "Bogon_192.0.0.0_24" "Bogon_192.0.2.0_24" "Bogon_192.88.99.0_24" "Bogon_192.168.0.0_16" "Bogon_198.18.0.0_15" "Bogon_198.51.100.0_24" "Bogon_203.0.113.0_24" "Bogon_224.0.0.0_4" "Bogon_240.0.0.0_4" "Bogon_255.255.255.255_32"
    next
end

config webfilter urlfilter
    edit 1
        set name "webfilter"
        config entries
            edit 1
                set url "*x.com"
                set type wildcard
                set action block
            next
            edit 2
                set url "www.spengergasse.at"
                set type simple
                set action block
            next
        end
    next
end

config webfilter profile
    edit "webprofile"
        config web
            set urlfilter-table 1
        end
        config ftgd-wf
        end
    next
end

config firewall policy
    edit 2
        set name "WF"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set utm-status enable
        set inspection-mode proxy
        set logtraffic all
        set webfilter-profile "webprofile"
        set profile-protocol-options default
        set ssl-ssh-profile custom-deep-inspection
        # are we sure about this being here?
        set nat enable
    next
end



